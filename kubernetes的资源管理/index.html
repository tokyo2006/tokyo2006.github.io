<!DOCTYPE html>
<html class="no-js" lang="en-US" prefix="og: https://ogp.me/ns# fb: https://ogp.me/ns/fb#">
<head>
    <meta charset="utf-8">

    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="description" content="">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="description" content="kubernetes的资源管理">
<meta name="keywords" content="devops, kubernetes, ">

 
<meta property="og:type" content="article"/>
<meta property="og:description" content="kubernetes的资源管理"/>
<meta property="og:title" content="kubernetes的资源管理 : blog.lkjxblog.site"/>
<meta property="og:site_name" content="blog.lkjxblog.site is Chen Zeng"/>
<meta property="og:image" content="" />
<meta property="og:image:type" content="image/jpeg" />
<meta property="og:image:width" content="" />
<meta property="og:image:height" content="" />
<meta property="og:url" content="https://blog.lkjxblog.site/kubernetes%E7%9A%84%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86/">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2023-12-27"/>
<meta property="article:modified_time" content="2023-12-27"/>



<meta property="article:tag" content="devops">
<meta property="article:tag" content="kubernetes">





<meta name="twitter:card" content="summary">

<meta name="twitter:site" content="@rurounikexin">
<meta name="twitter:title" content="kubernetes的资源管理 : blog.lkjxblog.site">
<meta name="twitter:creator" content="@rurounikexin">
<meta name="twitter:description" content="kubernetes的资源管理">
<meta name="twitter:image:src" content="">
<meta name="twitter:domain" content="blog.lkjxblog.site">



    <base href="https://blog.lkjxblog.site/">
    <title>kubernetes的资源管理 - blog.lkjxblog.site</title>
    <link rel="canonical" href="https://blog.lkjxblog.site/kubernetes%E7%9A%84%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86/">
    

    <link href='//fonts.googleapis.com/css?family=Fjalla+One|Open+Sans:300' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="https://blog.lkjxblog.site//css/nixon.css">

    <link rel="shortcut icon" href="https://blog.lkjxblog.site//favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="https://blog.lkjxblog.site//apple-touch-icon.png" />
</head>

<body lang="en" itemscope itemtype="https://schema.org/Article">
<header id="header">
    <figure>
      <a href="https://blog.lkjxblog.site//" border=0 id="logolink"><div class="icon-nixon-home" id="logo"> </div></a>
    </figure>
    <div id="byline">by Chen Zeng</div>
    <nav id="nav">
            <ul id="mainnav">
            <li>
                <a href="https://blog.lkjxblog.site//">
                <span class="icon"> <i aria-hidden="true" class="icon-nixon-quill"></i></span>
                <span> blog </span>
            </a>
            </li>
            <li>
            <a href="https://blog.lkjxblog.site//project/">
                <span class="icon"> <i aria-hidden="true" class="icon-nixon-console"></i></span>
                <span> project </span>
            </a>
            </li>
            <li>
            <a href="https://blog.lkjxblog.site//talks/">
                <span class="icon"> <i aria-hidden="true" class="icon-nixon-talk"></i></span>
                <span> talks </span>
            </a>
            </li>
            <li>
            <a href="https://blog.lkjxblog.site//about/">
                <span class="icon"> <i aria-hidden="true" class="icon-nixon-linkedin"></i></span>
                <span> me </span>
            </a>
            </li>
        </ul>

        

    <ul id="social">
	<li id="share">
		<span class="icon icon-bubbles"> </span><span class="title"> share </span>
		<div class="dropdown share">
			<ul class="social">
				<li>
					<a href="https://twitter.com/intent/tweet?status=kubernetes%e7%9a%84%e8%b5%84%e6%ba%90%e7%ae%a1%e7%90%86-https%3a%2f%2fblog.lkjxblog.site%2fkubernetes%25E7%259A%2584%25E8%25B5%2584%25E6%25BA%2590%25E7%25AE%25A1%25E7%2590%2586%2f" target="_blank" title="Follow me on Twitter" class="twitter"><span class="icon icon-twitter"></span>Twitter</a>
				</li>
				<li>
					<a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.lkjxblog.site%2fkubernetes%25E7%259A%2584%25E8%25B5%2584%25E6%25BA%2590%25E7%25AE%25A1%25E7%2590%2586%2f" target="_blank" title="Join me on Facebook" class="facebook"><span class="icon icon-facebook"></span>Facebook</a>
				</li>
				<li>
					<a href="https://plus.google.com/share?url=https%3a%2f%2fblog.lkjxblog.site%2fkubernetes%25E7%259A%2584%25E8%25B5%2584%25E6%25BA%2590%25E7%25AE%25A1%25E7%2590%2586%2f" target="_blank" title="Google+" class="googleplus"><span class="icon icon-google-plus"></span>Google+</a>
				</li>

				<li>
					<a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fblog.lkjxblog.site%2fkubernetes%25E7%259A%2584%25E8%25B5%2584%25E6%25BA%2590%25E7%25AE%25A1%25E7%2590%2586%2f&title=kubernetes%e7%9a%84%e8%b5%84%e6%ba%90%e7%ae%a1%e7%90%86&source=https%3a%2f%2flinkedin.com%2fin%2fdawnzeng" target="_blank" title="LinkedIn" class="linkedin"><span class="icon icon-linkedin"></span>LinkedIn</a>
				</li>

				<li>
					<a href="https://del.icio.us/post?url=https%3a%2f%2fblog.lkjxblog.site%2fkubernetes%25E7%259A%2584%25E8%25B5%2584%25E6%25BA%2590%25E7%25AE%25A1%25E7%2590%2586%2f" target="_blank" title="Delicious" class="delicious"><span class="icon icon-delicious"></span>Delicious</a>
				</li>
				<li>
					<a href="https://www.reddit.com/submit?url=https%3a%2f%2fblog.lkjxblog.site%2fkubernetes%25E7%259A%2584%25E8%25B5%2584%25E6%25BA%2590%25E7%25AE%25A1%25E7%2590%2586%2f" target="_blank" title="Reddit" class="reddit"><span class="icon icon-reddit"></span>Reddit</a>
				</li>
			</ul>
			<span class="subcount">sharing is caring</span>
		</div>
	</li>
	<li id="follow">
		<span class="icon icon-rocket"> </span><span class="title"> follow </span>
		<div class="dropdown follow">
			<ul class="social">


				<li>
					<a href="https://www.twitter.com/rurounikexin" target="_blank" title="Follow me on Twitter" class="twitter"><span class="icon icon-twitter"></span>Twitter</a>
				</li>


				<li>
					<a href="https://www.facebook.com/fei.jianxin" target="_blank" title="Join me on Facebook" class="facebook"><span class="icon icon-facebook"></span>Facebook</a>
				</li>


				<li>
					<a href="https://www.linkedin.com/in/dawnzeng" target="_blank" title="LinkedIn" class="linkedin"><span class="icon icon-linkedin"></span>LinkedIn</a>
				</li>


				<li>
					<a href="https://github.com/tokyo2006" target="_blank" title="GitHub" class="github"><span class="icon icon-github"></span>GitHub</a>
				</li>



			</ul>
			<span class="subcount">join 10k+ subscribers &amp; followers</span>
		</div>
	</li>
</ul>

    </nav>
</header>



<section id="main">
  <h1 itemprop="name" id="title">kubernetes的资源管理</h1>
  <div>
        <article itemprop="articleBody" id="content">
           <pre><code>在kubernetes中我们是通过设置pod的CPU和内存来管理pod使用的资源的。kubernetes的调度策略也会根据资源设置的不同而有不同的处理方式。
</code></pre>
<h2 id="资源类型">资源类型</h2>
<p>通常在kubernetes中我们是通过以下字段来设置pod的资源的：</p>
<ul>
<li>请求的资源
<ul>
<li>spec.containers[].resources.requests.cpu</li>
<li>spec.containers[].resources.requests.memory</li>
</ul>
</li>
<li>极限资源
<ul>
<li>spec.containers[].resources.limits.cpu</li>
<li>spec.containers[].resources.limits.memory</li>
</ul>
</li>
</ul>
<p>在kubernetes中，pod不会因为CPU资源资源不足而被摧毁掉，这样的资源称之为可压缩资源，在资源不足的时候只是会pending住。但是对于内存资源，如果超过的limit,这个pod就会立即被杀死并会重新创建一个新的pod调度到合适的节点资源中，这样超过limit被催毁的资源被称之为不可压缩的资源。
而对于一个pod来说，它可能有很多个container组成，所以一个pod所需的资源是由所有的container所需资源的累加而成的。</p>
<h2 id="requests和limits的区别">requests和limits的区别</h2>
<p>requests表示这个pod在启动时候所需的最小资源。</p>
<blockquote>
<p>不难理解，当requests设置的越小，相比于设置大的requests的pod更容易的分配到资源紧张的节点中，因为kubernetes在调度的时候会根据你的requests的设置来分配所在的节点。</p></blockquote>
<p>limits表示这个pod在超过这个资源的时候是否等待资源（CPU）或者是否被内设摧毁掉（Memory）</p>
<blockquote>
<p>对于服务来说设置多大的limits需要根据一段时间的监控来确定这个数值到底是多少合适，这样既能节约资源，也能保证服务正常运行</p></blockquote>
<h2 id="kubernetes的qos模型quality-of-service服务质量">kubernetes的QoS模型（Quality of Service，服务质量）</h2>
<p>在Kubernetes中，QoS（Quality of Service，服务质量）模型用于根据容器的资源需求和优先级，为它们分配适当的资源。</p>
<p>Kubernetes的QoS模型根据容器的资源需求和优先级将容器分为三个不同的类别：</p>
<ul>
<li>Guaranteed（保证型）：这是最高优先级的类别。容器被标记为Guaranteed，表示它们要求系统提供其声明的所有资源。这些容器将被保证能够使用它们所请求的CPU和内存资源，而不会受到其他容器的影响。如果系统无法满足Guaranteed容器的资源需求，它们可能会被阻止调度或终止，在kubernetes的Eviction策略中是最后被Evict的。
<ul>
<li>当资源的limits和requests设置为相同的值的时候</li>
<li>当资源仅仅设置了limits的值的时候（因为kubernetes会自动为它设置与limits相同的requests值）</li>
</ul>
</li>
<li>Burstable（可突发型）：这是中等优先级的类别。容器被标记为Burstable，表示它们对资源有一定的需求，但也可以在需要时使用更多的资源进行突发。这些容器在资源紧张时可能会受到其他高优先级容器的影响，但在大多数情况下会获得它们所请求的资源。在kubernetes的Eviction策略中是比BestEffort类型后Evict的。
<ul>
<li>当pod中至少有一个container设置了requests,那么这个pod就会被划分为Burstable类型</li>
</ul>
</li>
<li>BestEffort（尽力型）：这是最低优先级的类别。BestEffort容器被标记为不要求任何特定的资源，并且它们只使用系统中未被其他容器使用的闲置资源。它们在资源紧张时会受到其他两个类别容器的影响，因此不能保证获得任何资源，在kubernetes的Eviction策略中是最优先被Evict的。
<ul>
<li>pod里面没有设置任何的requests和limits的时候</li>
</ul>
</li>
</ul>
<h2 id="kubernetes中的cpuset">kubernetes中的cpuset</h2>
<p>在kubernetes中可以通过cpuset来使得pod可以和节点的cpu资源进行绑定从而独享那一部分的cpu资源，而不是想cpushare那样共享cpu的计算能力。在产线环境中，我们最好来通过这样的设置来减少cpu上下文的切换次数，从而提升服务的性能。要实现cpuset也非常简单，只需要将cpu的requests和limits设置为同一个相等的数值即可，比如：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">backend</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">my-backend:latest</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">limits</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">memory</span>: <span style="color:#e6db74">&#34;1Gi&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">cpu</span>: <span style="color:#e6db74">&#34;1&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">requests</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">memory</span>: <span style="color:#e6db74">&#34;1Gi&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">cpu</span>: <span style="color:#e6db74">&#34;1&#34;</span>
</span></span></code></pre></div><p>此时应用就会独占一个核的资源，至于是CPU哪个核，这个就由kubernetes随机分配了。</p>
        </article>
  </div>
</section>



<aside id="meta">

<div>
	<section id="datecount">
		<h4 id="date"> Wed Dec 27, 2023 </h4>
		<h5 id="wc"> 1700 字数 </h5>
		<h5 id="readtime"> 需要阅读 4 分钟 </h5>
	</section>
	<ul id="categories">
	
		<li><a href="https://blog.lkjxblog.site//topics/devops">Devops</a> </li>
	
	</ul>
	<ul id="tags">
	
		<li> <a href="https://blog.lkjxblog.site//tags/devops">devops</a> </li>
	
		<li> <a href="https://blog.lkjxblog.site//tags/kubernetes">kubernetes</a> </li>
	
	</ul>
</div>

<div>
	<section id="prev">
		&nbsp;<a class="previous" href="https://blog.lkjxblog.site/%E8%BF%90%E7%BB%B4%E7%9C%BC%E4%B8%AD%E7%9A%84%E7%9B%91%E6%8E%A7%E5%92%8C%E5%91%8A%E8%AD%A6%E4%BB%A5%E5%8F%8A%E4%BA%8B%E6%95%85%E7%AE%A1%E7%90%86/"><i class="icon-nixon-arrow-left"></i> 运维眼中的监控和告警以及事故管理</a><br>
	</section>
	<section id="next">
		&nbsp;<a class="next" href="https://blog.lkjxblog.site/kubernetes%E7%9A%84%E4%BD%9C%E4%B8%9A%E8%B0%83%E5%BA%A6/">kubernetes的作业调度 <i class="icon-nixon-arrow-right"></i></a>
	</section>
</div>


</aside>

<meta itemprop="wordCount" content="1685">
<meta itemprop="datePublished" content="2023-12-27">
<meta itemprop="url" content="https://blog.lkjxblog.site/kubernetes%E7%9A%84%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86/">


<aside id=comments>
 <div><h2> Comments </h2></div>

<div id="container"></div>
<script src="https://beaudar.lipk.org/client.js"
        repo="tokyo2006/tokyo2006.github.io"
        issue-term="url"
        branch="master"
        theme="preferred-color-scheme"
        comment-order="desc"
        crossorigin="anonymous"
        label="comment"
        async>
</script>

</aside>

<footer>
	<div>
		<p>
			Copyright &copy; 2025
			
			<span itemprop="author" itemscope itemtype="https://schema.org/Person">
				<span itemprop="name">Chen Zeng.</span>
			</span>
			
			<a rel="license" href="https://blog.lkjxblog.site/license/"
				title="Creative Commons Attribution">all rights reserved</a>; Powered by <a
				href="https://gohugo.io">Hugo</a>.
		</p>
	</div>
</footer>
<script type="text/javascript">
	(function () {
		var j = function (a, b) {
			return window.getComputedStyle ? getComputedStyle(a).getPropertyValue(b) : a.currentStyle[b]
		};
		var k = function (a, b, c) {
			if (a.addEventListener) a.addEventListener(b, c, false);
			else a.attachEvent('on' + b, c)
		};
		var l = function (a, b) {
			for (key in b)
				if (b.hasOwnProperty(key)) a[key] = b[key];
			return a
		};
		window.fitText = function (d, e, f) {
			var g = l({
				'minFontSize': -1 / 0,
				'maxFontSize': 1 / 0
			}, f);
			var h = function (a) {
				var b = e || 1;
				var c = function () {
					a.style.fontSize = Math.max(Math.min(a.clientWidth / (b * 10), parseFloat(g
						.maxFontSize)), parseFloat(g.minFontSize)) + 'px'
				};
				c();
				k(window, 'resize', c)
			};
			if (d.length)
				for (var i = 0; i < d.length; i++) h(d[i]);
			else h(d);
			return d
		}
	})();
	fitText(document.getElementById('title'), 1)

</script>

</body>

</html>

